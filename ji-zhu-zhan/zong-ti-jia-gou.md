# 总体架构

## 总体架构

云原生总体架构分层设计，有：交互集成层、开放服务集成层、应用编排部署层、基础设施层，运维管理体系，见下图：![](/assets/CloudNativeArchitecture.png)

## 交互集成层

交互集成层的设计，考虑支持三种集成模式：支持移动端与桌面端的插件开放框架、App深度链接调起及桌面浏览器跨域可复用组件。

* 插件开放框架：前端插件开放框架基于Javascript SDK设计，按照应急与指挥业务需要提供基础的界面导航模式与交互应用范例，平台中的POC、GIS、任务等公共能力、及各行业能力的用户交互组件，以插件方式集成到框架中；

* App深度链接调起：深度链接\(Deeplinking\)是在客户即有应用中，通过链接启动应急平台的移动端原生App，并跳转到原生App中指定功能页面，可实现在行业即有App中调起应急指挥用户账号体系的单点登录、POC能力、任务管理能力、及平台其他能力，以实现应急指挥App与行业用户App并存的一体化用户体验。

* 前端可复用组件：平台的公共能力、行业能力用户界面，按照主流前端框架（如Vue、React、Angular、Android、iOS等）组件的方式进行封装，以便行业用户的信息化技术服务商，将平台能力快速嵌入行业用户既有应急指挥体系应用中，支持平台能力的快速交付与集成。

* Javascript SDK：采用MVVM设计模式进行构建，抽象出统一的视图层模型View Mode，通过视图层模型封装与应用服务API网购的Restful交互、原生对象桥交互、设备原生能力（POC能力、摄像头、媒体播放等能力通过原生对象桥进行封装）。

* 原生SDK：给原生技术开发的应用提供支持，除了既有的Android、iOS以外；进一步提供基于Electron跨平台框架的Windows、Linux、MacOS桌面版SDK，在Electron SDK中可以充分复用Javascript  SDK及Web组件。

## 开放服务集成层

开放服务集成层，以互联开放服务集成为设计目的，通过应用服务API网关进行平台服务能力治理，将实施流媒体网络服务融入集成层，遵循OpenAPI规范集成平台能力与第三方服务，通过OAuth2与OpenID Connect规范实现统一身份验证与能力接入。

* 应用服务API网关：遵循OpenAPI规范，通过应用服务API网关实现客户端访问统一入口，作为服务治理的核心机制，所有外部客户端访问都需要经过API网关来进行调度和过滤，实现服务能力路由规范管理、负责均衡、访问控制、服务能力发布与生命周期管理、校验过滤等功能，并为服务能力提供访问流量控制、服务聚合等一系列功能。

* 实时流媒体网络服务：依据业务需要在提供优化的实时流媒体传输网络服务资源及RTSP、WebRTC等主要实时流媒体转码服务。实时流媒体服务还可进一步兼容WebRTC，以实现跨平台/浏览器客户的需求。

* 统一身份认证：对于集成到开放平台的用户、开发者、及其所属组织机构、应用等各个角色（Actor）进行统一身份认证管理，基于OAuth及OpenID Connect协议进行服务治理与应用集成，可以实现身份认证联邦，支持跨应用、跨服务单点登录。

## 应用编排部署层

平台基于容器技术，支持多租户业务部署，基于能力提供商能力服务编排清单、与客户签订的能力容量需求及SLA，通过应用编排部署服务，将私有容器镜像存储中的能力业务应用模版，编排实例化为容器集群。

* 资源中心：支持多租户部署，为每个租户存储跨业务能力的共享资源，资源中心如需要支持跨区域多中心部署，在各区域数据中心内的实例采用一主多从模式进行部署，各区之间数据保持同步。

* 能力目录：支持多租户部署，各能力可以共享客户资源中心的资源信息，能力服务如需要支持跨区多中心部署，在各区域数据中心内的实例采用按业务分区模式进行部署，各区之间的能力服务可以相互调用。

* 应用编排部署服务：基于Docker技术，采用Kubernetes进行应用编排部署，在数据中心本地建立私有容器镜像仓库存储业务应用镜像模版。

## 基础设施层

基础设施层提供网络、计算、存储等计算资源，支持多云计算平台提供商、多数据中心、公有云与私有云混合云架构。

## 运维管理体系

* 集成MDM设备管理平台，可通过后台管理接入的移动设备信息及证书、提供APN及VPN优先接入、提供客户特定的应用管理策略、对设备进行远程管理监控；

* 设备端SDK/框架/组件的DevOps流程管理，实现交互集成层软件的持续集成、持续交付、维护开发、测试、生产环境。

* 实现能力提供者注册、实名验证、应用能力接入 相关App\_ID、App\_Secrete及证书管理 ；

* 实现客户账户开通、用户账户分配、业务开通与业务订购关系管理。

* 依据客户能力订阅关系、用户数量、能力用量、资源用量生成用量统计单

* 平台后台的DevOps流程管理，实现交互集成层软件的持续集成、持续交付、维护开发、测试、生产环境。

* 集成云平台节点健康监控信息，集中告警

* 集成云平台网络安全监控信息，QoS报告信息，集中告警









